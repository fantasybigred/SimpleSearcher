<!DOCTYPE html>
<html lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
	<title>新浪港股通</title>
	<link rel="stylesheet" href="css/download.css">
	<link rel="stylesheet" href="css/pcDownload.css">
	<!--[if lt IE 9]> 
		<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
	<![endif]-->
</head>
<body>
	<div id="phone" style="display:none">
		<div class="page">
			<img src="css/images/download_bg.png" alt="">
		</div>
		<div class="phone">
			<img src="css/images/phone.png" alt="">
		</div>
		<div class="buttob_w">
			<div id="downloadApp" class="button">立即下载</div>
		</div>
		<div class="download_tip"></div>
	</div>
	<div id="pc" style="display:none">
		<div id="s1">
			<div class="showcenter">
				<div class="s1_top">
					<div class="s1_top_left">
						<a href="javascript:void(0);">
							<img src="css/images/ic_logo@2x.png" alt="新浪港股通" title="新浪港股通" />
						</a>
					</div>
					<p class="s1_top_right">
						<a href="http://finance.sina.com.cn/stock/hkstock/" target="_blank" is_link="1" class="a_rwm" >新浪港股</a> | 
						<a href="http://weibo.com/u/2418201593?refer_flag=1001030101_&is_all=1" target="_blank"  is_link="1" class="a_rwm" >官方微博</a> |  
						<a href="javascript:void(0);" is_link="0" class="a_rwm" itemid="rwm_gfwx">官方微信</a>
					</p>
					<p class="hid_rwm">
						<img id="rwm_gfwx" src="css/images/gfwx_ewm@2x.png" />
					</p>
				</div>
				<div class="s1_main">
					<div class="s1_main_left">
						<img src="css/images/phone@2x.png" alt="新浪港股通" title="新浪港股通" />
					</div>
					<div class="s1_main_right">
						<div class="s1_mr_t">
							<img src="css/images/ic_title@2x.png" alt="新浪港股通" title="新浪港股通" />
						</div>
						<div class="s1_mr_b">
							<div class="downloadbtn">
								<div class="download_btn download_btn_primary download_ios" data-href="https://itunes.apple.com/cn/app/id1128660260" alt="新浪港股通" title="新浪港股通">
									App Store下载
								</div>
								<div class="download_btn download_btn_primary download_android" data-href="http://api.ggt.sina.com.cn/apk/sinaggt.apk" alt="新浪港股通" title="新浪港股通">
									Android下载
								</div>
							</div>
							<div class="qrcode">
								<img src="css/images/ic_dimension@2x.png" alt="新浪港股通" title="新浪港股通" />
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div id="s2">
			<div class="showcenter">
				<div class="f_left w_text">
					<h2>免费实时行情</h2>
					<p>港股/A股实时行情免费获取</p>
				</div>
				<div class="f_right w_img">
					<img src="css/images/ic_picture_one@2x.png" alt="新浪港股通" title="新浪港股通" />
				</div>
			</div>
		</div>
		
		<div id="s3">
			<div class="showcenter">
				<div class="f_left w_img">
					<img src="css/images/ic_picture_two@2x.png" alt="新浪港股通" title="新浪港股通" />
				</div>
				<div class="f_right w_text">
					<h2>独家港股资讯</h2>
					<p>7*24小时 港股财经资讯</p>
				</div>
			</div>
		</div>
		
		<div id="s4">
			<div class="showcenter">
				<div class="f_left w_text">
					<h2 class="small">港交所OMD核心<br/>创始成员</h2>
					<p>新浪公司为香港交易所OMD<br/>数据枢纽核心创始成员</p>
				</div>
				<div class="f_right w_img">
					<img src="css/images/ic_picture_three@2x.png" alt="新浪港股通" title="新浪港股通" />
				</div>
			</div>
		</div>
		
		<div id="s5">
			<div class="showcenter">
				<div class="download_btn download_btn_rect download_ios" data-href="https://itunes.apple.com/cn/app/id1128660260" alt="新浪港股通" title="新浪港股通">
					iPhone
				</div>
				<div class="download_btn download_btn_rect download_android" data-href="http://api.ggt.sina.com.cn/apk/sinaggt.apk" alt="新浪港股通" title="新浪港股通">
					Android
				</div>
				<div class="download_btn download_btn_rect download_qrcode" alt="新浪港股通" title="新浪港股通">&nbsp;</div>
			</div>
		</div>
		
		<div id="s6">
			<div class="showcenter">
				<p>新浪公司 版权所有</p>
				<p>Copyright © 1996-2016 SINA Corporation, All Rights Reserved</p>
			</div>
		</div>
	</div>
</body>
</html>
<script src="lib/jquery-1.8.2.min.js"></script>
<script type="text/javascript">
	function IsPC(){  
		var _userAgent = navigator.userAgent;
		var Agents = new Array("Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod");
		var flag = true;
		for(var v = 0; v < Agents.length; v++){
			if(_userAgent.indexOf(Agents[v]) > 0){ 
				flag = false;
				break;
			}
		}
		return flag;
	}

	function bindPcEvents(){
		$('.a_rwm').hover(function(){
			var is_link=$(this).attr('is_link');
			if(is_link=='1'){
				$(this).css('text-decoration','underline');
			}else{
				var to=$(this).attr('itemid');
				$('.hid_rwm').show().find('#'+to).show();
			}
		},function(){
			var is_link=$(this).attr('is_link');
			if(is_link=='1'){
				$('.a_rwm').css('text-decoration','none');
			}else{
				var to=$(this).attr('itemid');
				$('#'+to).hide();
				$('.hid_rwm').hide();
			}
		});
		$('.download_btn').on('click',function(){
			var _href = $(this).attr('data-href');
			if(_href)
				window.location.href = _href;
		});
	}

	var android_app_url = 'http://api.ggt.sina.com.cn/apk/sinaggt.apk',
		wx_app_url = 'http://a.app.qq.com/o/simple.jsp?pkgname=com.sina.ggt',
		ios_app_url = 'https://itunes.apple.com/cn/app/id1128660260',
		nativeUrl = 'sinaggt://api.ggt.sina.com.cn';
	var Tools = function(){};
	Tools.prototype = {
		_userAgent: navigator.userAgent.toLowerCase(),
		isAndroid: function() {
			if (this._userAgent.indexOf('android') > -1)
				return true;
			return false;
		},
		isIOS: function() {
			if (this._userAgent.match(/(iphone|ipod|ipad);?/i))
				return true;
			return false;
		},
		isTencent: function() {
			var isWeiXin = this._userAgent.indexOf('micromessenger') > -1,
				isQQBrowser = this._userAgent.indexOf('mqqbrowser') > -1,
				isQQ = this._userAgent.indexOf('qq') > -1;
			if (isWeiXin || isQQBrowser || isQQ)
				return true;
			return false;
		},
		downloadApp: function(){
			if(this.isIOS() && !this.isTencent()) {
				this.installUrl = ios_app_url;
				this.nativeUrl = ios_app_url;
				this.openTime = 800;
				this._gotoNative();
			}else if(this.isAndroid() && !this.isTencent()) {
				this.installUrl = android_app_url;
				this.nativeUrl = nativeUrl;
				this.openTime = 800;
				this._gotoNative();
			}else if(this.isTencent()){
				window.location.href = wx_app_url;
			}else{
				window.open(android_app_url, '_blank');
			}
		},
		init: function() {
            
            // pc下 什么都不处理  pc访问下可能href可以链接去其他地址
            if(this.isIOS() && !this.isTencent()) {
				this.installUrl = ios_app_url;
				this.nativeUrl = ios_app_url;
				this.openTime = 800;
				this._gotoNative();
			}else if(this.isAndroid() && !this.isTencent()) {
				this.installUrl = android_app_url;
				this.nativeUrl = nativeUrl;
				this.openTime = 3000;
				this._gotoNative();
			}else if(this.isTencent()){
				window.location.href = wx_app_url;
			}else{
				window.open(android_app_url, '_blank');
			}
            
        },
		_gotoNative: function() {
            var self = this;
            var startTime = Date.now(),
                doc = document,
                body = doc.body,
                iframe = doc.createElement('iframe');
                iframe.id = 'J_redirectNativeFrame';
                iframe.style.display = 'none';
                iframe.src = self.nativeUrl;

            //运行在head中
            if(!body) {
                setTimeout(function(){
                    doc.body.appendChild(iframe);
                }, 0);
            } else {
                body.appendChild(iframe);
            }
            
            setTimeout(function() {
                doc.body.removeChild(iframe);
                self._gotoDownload(startTime);
                /**
                 * 测试时间设置小于800ms时，在android下的UC浏览器会打开native app时并下载apk，
                 * 测试android+UC下打开native的时间最好大于800ms;
                 */
            }, self.openTime);
        },
        /**
         * [_gotoInstall 去下载]
         * @param  {[type]} startTime [开始时间]
         * @return 
         */
        _gotoDownload: function(startTime) {
            var self = this;
            var endTime = Date.now();
            if (endTime - startTime < self.openTime + 500) {
                window.location = self.installUrl;
            }
        },
	};
	var tools = new Tools();

	function bindPhoneEvents(){
		tools.downloadApp();
		document.getElementById("downloadApp").onclick = function(){
			tools.downloadApp();
		};
	}

	function changePcOrPhone(){
		if(IsPC()){
			$("#phone").hide();
			$("#pc").show();
			bindPcEvents();
		}else{
			$("#pc").hide();
			$("#phone").show();
			bindPhoneEvents();
		}
	}



	$(document).ready(function(){
		changePcOrPhone();
	});
	$(window).on('resize', function(){
		changePcOrPhone();
	})
</script>


